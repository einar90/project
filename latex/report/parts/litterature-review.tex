% -*- root: ../project.tex -*-

\section{Litterature review} % (fold)
\label{sec:litterature_review}
For simplicity only equations dealing for single-phase, two-dimensional, steady-state flow in a homogeneous reservoir will be discussed in this section.

\subsection{Well Indexes} % (fold)
\label{sub:well_indices}
In numerical reservoir simulation, the \gls{wi}\footnote{The term \gls{cf} is also used by some authors\cite{Peaceman2003New,Schlumberger2013Eclipse}.} is used to relate the flowing well pressure, $p_{wf}$\nomenclature{$p_{wf}$}{flowing well pressure},  to the numerical wellblock pressure, $p_{wb}$\nomenclature{$p_{wb}$}{wellblock pressure}. The well index takes into account the wellblock geometry and the location and orientation of the well segment in the gridblock, as well as rock properties \cite{Peaceman2003New}.

The well index is used when calculating the flow rate into the well. For single-phase radial flow the it may be written as
\begin{equation}
    \label{eq:peaceman-wi1}
    q = \frac{WI}{\mu} \left( p_{wb} - p_{wf} \right)
\end{equation}
where $q$\nomenclature{$q$}{volumetric flow rate $[\mathrm{m^3/s}]$} is the volumetric flow rate into the well \nomenclature{$\mu$}{viscosity}\nomenclature{$WI$}{well index}\cite{Peaceman2003New}.

For a single well in a two-dimensional reservoir reservoir, Darcy's law for radial one-phase flow in the absence of skin effect can be expressed as
\begin{equation}
    q = \frac{kA}{\mu} \frac{\mathrm{d}p}{\mathrm{d}r}
\end{equation}
which after separating variables, integrating from $p_{wf}$ to $p$ and solving for $p$ gives us the radial flow equation
\begin{equation}
    \label{eq:dake-radial-pressure}
    p = p_{wf} + \frac{q\mu}{2\pi kh} \ln{\frac{r}{r_w}}
\end{equation}
and
\begin{equation}
    \label{eq:dake-radial-pressure-re}
    p_e = p_{wf} + \frac{q\mu}{2\pi kh} \ln{\frac{r_e}{r_w}}
\end{equation}
where $p_e$ is the effective pressure at the ``drainage radius'' $r_e$ \cite{Dake1978Developments} obtained from
\begin{equation}
    \label{eq:peaceman-pe}
    p_e = p_{wb} + F_i \sum_{i=1}^{4}\left( p_i - p_{wb} \right)
\end{equation}
where $F$ is a factor determining the influence of $p_i$ on $p_e$ in the horizontal plane, and is taken as zero \cite{Schwabe1967Prediction,Peaceman1978Interpretation}. $p_i$ represents the blocks surrounding the wellblock (illustrated in Figure~\ref{fig:peaceman-block-numbering}). Thus, equation equation \eqref{eq:dake-radial-pressure-re} is reduced to
\begin{equation}
    \label{eq:peaceman-pwb}
    p_{wb} = p_{wf} + \frac{q\mu}{2\pi kh} \ln{\frac{r_{eq}}{r_w}}
\end{equation}
where $r_{eq}$ is the equivalent wellblock radius, the radius at which the single well radial-flow equation gives the same pressure as the wellblock pressure\cite{Peaceman1978Interpretation,Peaceman2003New}.
\nomenclature{$p_e$}{effective pressure at drainage radius}
\nomenclature{$h$}{formation thickness}
\nomenclature{$k$}{permeability}
\nomenclature{$r$}{radius}
\nomenclature{$r_w$}{wellbore radius}
\nomenclature{$r_{eq}$}{equivalent wellblock radius}

Substitution of equation \eqref{eq:peaceman-pwb} into equation \eqref{eq:peaceman-wi1} and solved for $WI$ yields
\begin{equation}
    \label{eq:peaceman-wi2}
    WI = \frac{2\pi kh}{\ln{r_{eq}/r_w}}
\end{equation}

\begin{figure}[htbp]
    \centering
    \includegraphics[]{figures/grids/peaceman77-blocks.pdf}
    \caption{Illustration of the block numbering for equation \eqref{eq:peaceman-pe}.}
    \label{fig:peaceman-block-numbering}
\end{figure}
% subsection well_indices (end)





\subsection{Equivalent Wellblock Radius} % (fold)
\label{sub:equivalent_wellblock_radius}
The correct value for the equivalent wellblock radius $r_{eq}$ may be found by examining a numerical solution to the \hl{differential flow equation} on an $M\times M$ square grid like the one shown in Figure~\ref{fig:peaceman-grid}.

\begin{figure}[htbp]
    \centering
    \includegraphics[]{figures/grids/peaceman77-10x10.pdf}
    \caption{$10\times 10$ grid used with the five-point stencil. The circle in the lower-left corner represents a producing well; the dot in the upper-right corner represents an injector.}
    \label{fig:peaceman-grid}
\end{figure}





\subsubsection{Derivation of the discretized differential flow equation} % (fold)
\label{ssub:derivation}
To derive the discrete form of the \hl{differential flow equation}, we  start with the continuity equation for two-dimensional, single-phase, compressible flow \cite{Peaceman1977Fundamentals}
\begin{equation}
    \label{eq:continuity-2d}
    - \frac{\partial}{\partial x} \left( h\rho v_x \right) - \frac{\partial}{\partial y} \left( h\rho v_y \right) + hQ = h \frac{\partial }{\partial t} \left( \phi \rho \right)
\end{equation}
where $Q$ is the mass rate of injection/production per unit volume of reservoir
\begin{equation}
    \label{eq:mass-rate}
    Q = \frac{q\rho}{Ah}.
\end{equation}
\nomenclature{$Q$}{mass rate of injection per unit volume of reservoir $[\mathrm{kg/m^3s}]$}
Substituting equation \eqref{eq:mass-rate} and applying steady state conditions reduces equation \eqref{eq:continuity-2d} to
\begin{equation}
    - \frac{\partial}{\partial x} \left( h\rho v_x \right) - \frac{\partial}{\partial y} \left( h\rho v_y \right) + \frac{q\rho}{A} = 0
\end{equation}
substituting Darcy's law in the $x$- and $y$-directions \cite{Peaceman1977Fundamentals}
\begin{subequations}
    \begin{equation}
        v_x = -\frac{k}{\mu} \frac{\partial p}{\partial x}
    \end{equation}
    \begin{equation}
        v_y = -\frac{k}{\mu} \frac{\partial p}{\partial y}
    \end{equation}
\end{subequations}
and assuming constant $h,\rho,k$ and $\mu$ gives us the \hl{differential flow equation} for 2-dimensional incompressible flow in a homogeneous reservoir
\begin{equation}
    \label{eq:differential-flow}
    \frac{khA}{\mu} \frac{\partial^2 p}{\partial x^2}  + \frac{khA}{\mu} \frac{\partial^2 p}{\partial y^2} = -q
\end{equation}

To acquire a discretized form of equation \eqref{eq:differential-flow}, we apply a central Taylor expansion to the pressure differential to get
\begin{subequations}
    \begin{equation}
        \frac{\partial^2 p_{i,j}}{\partial x^2} = \frac{p_{i-1,j} -2p_{i,j} + p_{i+1,j}}{\Delta x^2} + O(\Delta x^2)
    \end{equation}
    \begin{equation}
        \frac{\partial^2 p_{i,j}}{\partial y^2} = \frac{p_{i,j-1} -2p_{i,j} + p_{i,j+1}}{\Delta y^2} + O(\Delta y^2)
    \end{equation}
\end{subequations}
where $O(\Delta x^2)$ and $O(\Delta x^2)$ are the error-terms. Substituting this and $A=\Delta x \Delta y$ into \eqref{eq:differential-flow} and taking $\Delta x = \Delta y$ gives us the discretized form
\begin{equation}
    \label{eq:differential-flow-discretized}
    \frac{kh}{\mu} \left( p_{i-1,j} -2p_{i,j} + p_{i+1,j} \right) + \frac{kh}{\mu} \left( p_{i,j-1} -2p_{i,j} + p_{i,j+1} \right) = -q_{i,j}
\end{equation}

We then define
\begin{equation}
    p_D = \frac{kh}{q\mu} p
\end{equation}
to get the dimensionless form of equation \eqref{eq:differential-flow-discretized} \cite{Peaceman1978Interpretation}
\begin{equation}
    \label{eq:differential-flow-discretzed-dimensionless}
     (p_D)_{i-1,j} -2(p_D)_{i,j} + (p_D)_{i+1,j} \;\;\; + \;\;\; (p_D)_{i,j-1} -2(p_D)_{i,j} + (p_D)_{i,j+1}  = \delta_{i,j}
\end{equation}
where
\begin{equation}
    \delta_{i,j} = 0 \;\mathrm{for}\; i,j \neq 0,0 \;\mathrm{or}\; M,M, \;\;\;\;\;\;
    \delta_{0,0} = 1, \;\;\;\;\;\;
    \delta_{M,M} = -1.
\end{equation}

The following reflection conditions are used:
\begin{equation}
    \begin{rcases}
        p_{-1,j} &= p_{1,j} \\
        p_{M+1,j} &= p_{M-1,j}
    \end{rcases} \; \mathrm{for} \; 0\leq j \leq M
\end{equation}
and
\begin{equation}
    \begin{rcases}
        p_{i,-1} &= p_{i,1} \\
        p_{i,M+1} &= p_{i,M-1}
    \end{rcases} \; \mathrm{for} \; 0\leq i \leq M
\end{equation}
Substitution of these conditions gives us an $(M+1)\times (M+1)$ equation system which may be solved directly. An implementation of a general solver for this set of equations is shown in Listing~\ref{lst:peaceman77_solver} in Appendix~\ref{sec:program_listings}.
% subsubsection derivation (end)






\subsubsection{Approximate calculation of equivalent radius} % (fold)
\label{ssub:approximate_calculation_of_equivalent_radius}
A plot of the solution to the discretized \hl{differential flow equation} on the $10 \times 10$ grid in Figure~\ref{fig:peaceman-grid} is shown in Figure~\ref{fig:peaceman77_pressure_vs_radius}. By extrapolating  the regression line to the horizontal line $p_{i,j}-p_{0,0}=0$, i.e. where $r=r_{eq}$, we get that
\begin{equation}
    r_{eq} = 0.2 \Delta x
\end{equation}
This result is used for a new interpretation of the wellblock pressure: it is the steady-state flowing pressure at $r=r_{eq}=0.2 \Delta x$ \cite{Peaceman1978Interpretation}.

We can also see in Figure~\ref{fig:peaceman77_pressure_vs_radius} that the pressure calculated for the block adjacent to the wellblock, i.e. at $r/\Delta x=1$, is on the straight line. Thus we can substitute $r=\Delta x$ into the radial flow equation \eqref{eq:dake-radial-pressure} to obtain the equation for the pressure in the adjacent block
\begin{equation}
    \label{eq:peaceman-pressure-adjacent}
    p_1 = p_{wb} + \frac{q\mu}{2\pi kh} \ln{\frac{\Delta x}{r_{eq}}}
\end{equation}
We now use equation \eqref{eq:differential-flow-discretized}, numbering as shown in Figure~\ref{fig:peaceman-block-numbering}
\begin{equation}
    \label{eq:peaceman-pressure-adjacent-discrete}
    \frac{kh}{\mu} \left( p_1 + p_2 + p_3 + p_4 -4p_{wb}  \right) = q
\end{equation}
where, by symmetry,
\begin{equation}
    \label{eq:peaceman-adjacent-symmetry}
    p_1=p_2=p_3=p_4.
\end{equation}
Combining equations \eqref{eq:peaceman-pressure-adjacent}, \eqref{eq:peaceman-pressure-adjacent-discrete} and \eqref{eq:peaceman-adjacent-symmetry} gives us
\begin{equation}
    \ln{\frac{\Delta x}{r_{eq}}} = \frac{\pi}{2}
\end{equation}
or
\begin{equation}
    r_{eq} = \Delta x \exp{\left( -\frac{\pi}{2} \right)} = 0.208 \Delta x
\end{equation}
which fits well with the results from the intersection of the regression line for $M\times M$ grids where $M\geq 20$ (see Table~\ref{tbl:peaceman-results}).

\begin{figure}[htbp]
    \centering
    \includegraphics[]{figures/plots/peaceman77-regression.pdf}
    \caption{Plot of numerical solution of pressure plotted agains radius from producing well. Calculations are done using the program in Listing~\ref{lst:peaceman77_solver}. The equation is solved on a $10\times 10$ grid like the one shown in Figure~\ref{fig:peaceman-grid}.}
    \label{fig:peaceman77_pressure_vs_radius}
\end{figure}

% subsubsection approximate_calculation_of_equivalent_radius (end)





\subsubsection{Exact calculation of equivalent radius} % (fold)
\label{ssub:exact_calculation_of_equivalent_radius}
It is also possible to calculate $r_{eq}$ exactly without using regression (as shown in Figure~\ref{fig:peaceman77_pressure_vs_radius}) \cite{Peaceman1978Interpretation}. This is done by solving the dimensionless numerical steady-state pressure equation \eqref{eq:differential-flow-discretzed-dimensionless}

% subsubsection exact_calculation_of_equivalent_radius (end)

\begin{table}
    \centering
    \caption{Computed equivalent radius of well-block $r_o$ for various values of $M$. $(p_D)_{M,M} - (p_D)_{o,o}$ is the dimensionless pressure drop between producer and injector, calculated using \hl{equation}; $r_o/\Delta x$ (exact) refers to the solution using \hl{equation}; $r_o / \Delta x$ (regression) refers to the point where the regression line crosses the $x$-axis (see Figure~\ref{fig:peaceman77_pressure_vs_radius}).}
    \begin{tabular}{rccc}
        \toprule
        $M$ & $(p_D)_{M,M} - (p_D)_{o,o}$ & $r_o/\Delta x$ (exact) & $r_o / \Delta x$ (regression)\\
        \midrule
        3   & 0.78571 & 0.1936 & 0.297 \\
        5   & 0.94346 & 0.1965 & 0.225 \\
        10  & 1.16209 & 0.1978 & 0.212 \\
        15  & 1.29078 & 0.1980 & 0.210 \\
        20  & 1.38222 & 0.1981 & 0.208 \\
        32  & 1.53173 & 0.1981 & 0.207 \\
        50  & 1.67375 & 0.1982 & 0.207 \\
        100 & 1.89436 & 0.1982 & 0.208 \\
        \bottomrule
    \end{tabular}
    \label{tbl:peaceman-results}
\end{table}

\begin{figure}[htbp]
    \centering
    \scalebox{0.7}{\input{figures/plots/peaceman77-contour_32x32.pgf}}
    \caption{Contour plot of the pressure difference calulated using equation \eqref{eq:differential-flow-discretzed-dimensionless} with $M=32$, solved using the program listing \ref{lst:peaceman77_solver}. The injector is placed in the upper right corner; the producer is placed in the lower left corner. The pressure difference is calculated relative to the block containing the producer.}
    \label{fig:pressure_drop_contour}
\end{figure}

% subsection equivalent_wellblock_radius (end)

% section litterature_review (end)
